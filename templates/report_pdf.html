<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Book Proposal Evaluation - {{ proposal.book_title }}</title>
    <style>
        @page { size: letter; margin: 1in; }
        body { font-family: Helvetica, Arial, sans-serif; font-size: 11pt; line-height: 1.5; color: #333; }
        .header { text-align: center; border-bottom: 3px solid #4a2c5a; padding-bottom: 20px; margin-bottom: 30px; }
        .logo { font-size: 24pt; font-weight: bold; color: #4a2c5a; }
        .tagline { font-size: 10pt; color: #666; margin-top: 5px; }
        h1 { font-size: 18pt; color: #4a2c5a; margin: 20px 0 10px; }
        h2 { font-size: 14pt; color: #4a2c5a; margin: 25px 0 10px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        h3 { font-size: 12pt; color: #4a2c5a; margin: 15px 0 8px; }
        .meta-info { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .meta-info table { width: 100%; }
        .meta-info td { padding: 5px 10px; }
        .meta-info .label { font-weight: bold; color: #666; width: 140px; }
        .tier-box { text-align: center; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .tier-a { background: #dcfce7; border: 2px solid #22c55e; }
        .tier-b { background: #dbeafe; border: 2px solid #3b82f6; }
        .tier-c { background: #fef3c7; border: 2px solid #f59e0b; }
        .tier-d { background: #fee2e2; border: 2px solid #ef4444; }
        .tier-letter { font-size: 48pt; font-weight: bold; }
        .tier-a .tier-letter { color: #16a34a; }
        .tier-b .tier-letter { color: #2563eb; }
        .tier-c .tier-letter { color: #d97706; }
        .tier-d .tier-letter { color: #dc2626; }
        .summary { background: #f8f6f9; padding: 15px; border-left: 4px solid #4a2c5a; margin: 20px 0; font-style: italic; }
        .advance-box { background: #fef3c7; border: 2px solid #c9a962; padding: 15px; text-align: center; border-radius: 8px; margin: 20px 0; }
        .advance-range { font-size: 20pt; font-weight: bold; color: #4a2c5a; }
        .category-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .category-table th { background: #4a2c5a; color: white; padding: 10px; text-align: left; }
        .category-table td { padding: 10px; border-bottom: 1px solid #ddd; vertical-align: top; }
        .category-table tr:nth-child(even) { background: #f9f9f9; }
        .score-cell { text-align: center; font-weight: bold; font-size: 14pt; width: 80px; }
        .score-high { color: #16a34a; }
        .score-mid { color: #d97706; }
        .score-low { color: #dc2626; }
        .list-section { margin: 15px 0; padding: 15px; border-radius: 5px; }
        .strengths { background: #dcfce7; border-left: 4px solid #22c55e; }
        .concerns { background: #fef3c7; border-left: 4px solid #f59e0b; }
        .next-steps { background: #f3e8ff; border-left: 4px solid #4a2c5a; }
        .list-section ul, .list-section ol { margin: 10px 0; padding-left: 25px; }
        .list-section li { margin-bottom: 8px; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #4a2c5a; text-align: center; font-size: 9pt; color: #666; }
        .page-break { page-break-before: always; }
        .category-detail { margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 5px; border-left: 4px solid #4a2c5a; }
        .category-detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .category-detail-name { font-size: 13pt; font-weight: bold; color: #4a2c5a; }
        .category-detail-score { font-size: 14pt; font-weight: bold; }
        .category-detail p { margin: 8px 0; font-size: 10.5pt; }
        .priority-actions { margin-top: 10px; padding: 10px; background: #fff; border: 1px solid #e5e7eb; border-radius: 4px; }
        .priority-actions strong { font-size: 9pt; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
        .priority-actions ul { margin: 5px 0 0; padding-left: 20px; }
        .priority-actions li { font-size: 10pt; margin-bottom: 4px; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">Write It Great</div>
        <div class="tagline">Elite Ghostwriting & Publishing Services</div>
    </div>

    <h1>Book Proposal Evaluation Report</h1>

    <div class="meta-info">
        <table>
            <tr><td class="label">Book Title:</td><td><strong>{{ proposal.book_title }}</strong></td></tr>
            <tr><td class="label">Author:</td><td>{{ proposal.author_name }}</td></tr>
            <tr><td class="label">Submission ID:</td><td>{{ proposal.submission_id }}</td></tr>
            <tr><td class="label">Evaluation Date:</td><td>{{ proposal.submitted_at.strftime('%B %d, %Y') if proposal.submitted_at else 'N/A' }}</td></tr>
        </table>
    </div>

    <div class="tier-box tier-{{ (proposal.tier or 'c')|lower }}">
        <div class="tier-letter">{{ proposal.tier or 'N/A' }}-Tier</div>
        <div>Overall Score: {{ proposal.overall_score|default(0, true)|round|int }}/100</div>
    </div>

    <h2>Executive Summary</h2>
    <div class="summary">{{ evaluation.get('summary', 'This proposal has been evaluated.') }}</div>

    {% if evaluation.get('advance_estimate') %}
    {% set advance = evaluation.get('advance_estimate', {}) %}
    <div class="advance-box">
        <div style="font-size: 10pt; color: #666;">Estimated Advance Range</div>
        <div class="advance-range">${{ "{:,.0f}".format(advance.get('low', 0)|float) }} - ${{ "{:,.0f}".format(advance.get('high', 0)|float) }}</div>
        <div style="font-size: 10pt; margin-top: 5px;">{{ advance.get('notes', '') }}</div>
    </div>
    {% endif %}

    <h2>Category Scores Overview</h2>
    <table class="category-table">
        <thead><tr><th>Category</th><th>Score</th><th>Feedback</th></tr></thead>
        <tbody>
        {% for key, cat in evaluation.get('categories', {}).items() %}
        {% set score = cat.get('score', 0)|float %}
        <tr>
            <td><strong>{{ key|replace('_', ' ')|title }}</strong></td>
            <td class="score-cell {% if score >= 70 %}score-high{% elif score >= 50 %}score-mid{% else %}score-low{% endif %}">{{ score|round|int }}</td>
            <td>{{ cat.get('feedback', 'No feedback available.') }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <div class="page-break"></div>

    <h2>Detailed Category Analysis</h2>
    {% for key, cat in evaluation.get('categories', {}).items() %}
    {% set score = cat.get('score', 0)|float %}
    <div class="category-detail">
        <div class="category-detail-header">
            <span class="category-detail-name">{{ key|replace('_', ' ')|title }}</span>
            <span class="category-detail-score {% if score >= 70 %}score-high{% elif score >= 50 %}score-mid{% else %}score-low{% endif %}">{{ score|round|int }}/100</span>
        </div>
        <p>{{ cat.get('feedback', 'No feedback available.') }}</p>
        {% if cat.get('priority_actions') %}
        <div class="priority-actions">
            <strong>Priority Actions:</strong>
            <ul>
            {% for action in cat.get('priority_actions', []) %}
                <li>{{ action }}</li>
            {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
    {% endfor %}

    {% if evaluation.get('strengths') %}
    <h2>Strengths</h2>
    <div class="list-section strengths">
        <ul>
        {% for item in evaluation.get('strengths', []) %}
            <li>{{ item }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if evaluation.get('red_flags') %}
    <h2>Areas of Concern</h2>
    <div class="list-section concerns">
        <ul>
        {% for item in evaluation.get('red_flags', []) %}
            <li>{{ item }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if evaluation.get('next_steps') %}
    <h2>Recommended Next Steps</h2>
    <div class="list-section next-steps">
        <ol>
        {% for item in evaluation.get('next_steps', []) %}
            <li>{{ item }}</li>
        {% endfor %}
        </ol>
    </div>
    {% endif %}

    <div class="footer">
        <p><strong>Write It Great</strong> | Elite Ghostwriting & Publishing Services</p>
        <p>www.writeitgreat.com | info@writeitgreat.com</p>
        <p>&copy; 2026 Write It Great. All rights reserved.</p>
    </div>
</body>
</html>
