{% extends "base.html" %}

{% block title %}Evaluation Results - {{ proposal.book_title }} - Write It Great{% endblock %}

{% block extra_css %}
.results-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
}

.results-header h1 {
    color: var(--gold);
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.results-header p {
    opacity: 0.9;
}

.results-container {
    max-width: 900px;
    margin: -2rem auto 2rem;
    position: relative;
    z-index: 10;
}

.score-card {
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.score-main {
    text-align: center;
}

.tier-display {
    font-size: 4rem;
    font-weight: 800;
}

.tier-a .tier-display { color: #16a34a; }
.tier-b .tier-display { color: #2563eb; }
.tier-c .tier-display { color: #d97706; }
.tier-d .tier-display { color: #dc2626; }

.score-number {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--gray-600);
}

.summary-box {
    flex: 1;
    min-width: 300px;
    background: var(--gray-50);
    padding: 1.5rem;
    border-radius: var(--radius);
    border-left: 4px solid var(--primary);
}

.summary-box p {
    font-size: 1.125rem;
    color: var(--gray-700);
    margin: 0;
}

.section-title {
    font-size: 1.25rem;
    margin: 2rem 0 1rem;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
}

.category-card {
    background: var(--gray-50);
    padding: 1.25rem;
    border-radius: var(--radius);
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.category-name {
    font-weight: 600;
    color: var(--gray-800);
}

.category-score {
    font-weight: 700;
    font-size: 1.25rem;
}

.score-high { color: #16a34a; }
.score-mid { color: #d97706; }
.score-low { color: #dc2626; }

.category-feedback {
    font-size: 0.875rem;
    color: var(--gray-600);
    line-height: 1.5;
}

.list-section {
    background: var(--gray-50);
    padding: 1.5rem;
    border-radius: var(--radius);
    margin-bottom: 1rem;
}

.strengths-box { border-left: 4px solid #22c55e; }
.flags-box { border-left: 4px solid #f59e0b; }
.steps-box { border-left: 4px solid var(--primary); }

.list-section ul,
.list-section ol {
    margin: 0;
    padding-left: 1.25rem;
}

.list-section li {
    margin-bottom: 0.5rem;
    color: var(--gray-700);
}

.advance-estimate {
    background: linear-gradient(135deg, var(--gold-light) 0%, white 100%);
    padding: 1.5rem;
    border-radius: var(--radius);
    text-align: center;
    border: 2px solid var(--gold);
    margin-bottom: 1.5rem;
}

.advance-range {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--primary);
    margin: 0.5rem 0;
}

.advance-note {
    font-size: 0.875rem;
    color: var(--gray-600);
}

.download-section {
    text-align: center;
    padding: 2rem;
    background: var(--gray-50);
    border-radius: var(--radius);
    margin-top: 2rem;
}

.email-notice {
    background: #dcfce7;
    color: #166534;
    padding: 1rem;
    border-radius: var(--radius);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

@media (max-width: 640px) {
    .score-card {
        flex-direction: column;
        text-align: center;
    }
    
    .tier-display {
        font-size: 3rem;
    }
}
{% endblock %}

{% block content %}
<section class="results-header">
    <h1>{{ proposal.book_title }}</h1>
    <p>by {{ proposal.author_name }}</p>
</section>

<div class="container results-container">
    <div class="card tier-{{ proposal.tier|lower }}">
        {% if proposal.author_email_sent %}
        <div class="email-notice">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
            <span>A copy of this evaluation has been sent to <strong>{{ proposal.author_email }}</strong></span>
        </div>
        {% endif %}

        <div class="score-card">
            <div class="score-main">
                <div class="tier-display">{{ proposal.tier }}-Tier</div>
                <div class="score-number">{{ proposal.overall_score|round|int }}/100</div>
            </div>
            <div class="summary-box">
                <p>{{ evaluation.get('summary', 'Your proposal has been evaluated.') }}</p>
            </div>
        </div>

        {% if evaluation.get('advance_estimate') %}
        <div class="advance-estimate">
            <div style="font-size: 0.875rem; color: var(--gray-600);">Estimated Advance Range</div>
            <div class="advance-range">
                ${{ "{:,.0f}".format(evaluation.advance_estimate.low) }} - ${{ "{:,.0f}".format(evaluation.advance_estimate.high) }}
            </div>
            <div class="advance-note">{{ evaluation.advance_estimate.notes }}</div>
        </div>
        {% endif %}

        <h3 class="section-title">üìä Category Scores</h3>
        <div class="category-grid">
            {% for key, cat in evaluation.get('categories', {}).items() %}
            <div class="category-card">
                <div class="category-header">
                    <span class="category-name">{{ key|replace('_', ' ')|title }}</span>
                    <span class="category-score {% if cat.score >= 70 %}score-high{% elif cat.score >= 50 %}score-mid{% else %}score-low{% endif %}">
                        {{ cat.score }}/100
                    </span>
                </div>
                <p class="category-feedback">{{ cat.feedback[:200] }}{% if cat.feedback|length > 200 %}...{% endif %}</p>
            </div>
            {% endfor %}
        </div>

        {% if evaluation.get('strengths') %}
        <h3 class="section-title">‚úÖ Strengths</h3>
        <div class="list-section strengths-box">
            <ul>
                {% for item in evaluation.strengths %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if evaluation.get('red_flags') %}
        <h3 class="section-title">‚ö†Ô∏è Areas of Concern</h3>
        <div class="list-section flags-box">
            <ul>
                {% for item in evaluation.red_flags %}
                <li>{{ item }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if evaluation.get('next_steps') %}
        <h3 class="section-title">üéØ Recommended Next Steps</h3>
        <div class="list-section steps-box">
            <ol>
                {% for item in evaluation.next_steps %}
                <li>{{ item }}</li>
                {% endfor %}
            </ol>
        </div>
        {% endif %}

        <div class="download-section">
            <h3>Download Your Full Report</h3>
            <p style="color: var(--gray-600); margin-bottom: 1.5rem;">Get a detailed PDF report with complete feedback for each section.</p>
            <a href="{{ url_for('download_pdf', submission_id=proposal.submission_id) }}" class="btn btn-primary">
                üì• Download PDF Report
            </a>
        </div>
    </div>
</div>
{% endblock %}
