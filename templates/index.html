{% extends "base.html" %}
{% block title %}Submit Your Book Proposal - Write It Great{% endblock %}
{% block content %}
<section class="hero">
    <h1>Book Proposal Evaluation</h1>
    <p>Get expert feedback on your book proposal from our team of publishing professionals.</p>
</section>

<div class="container form-container">
    <div class="card">
        <form id="proposal-form" enctype="multipart/form-data">
            <div class="form-group">
                <label for="author_name">Your Full Name *</label>
                <input type="text" id="author_name" name="author_name" required placeholder="John Smith">
            </div>
            <div class="form-group">
                <label for="author_email">Email Address *</label>
                <input type="email" id="author_email" name="author_email" required placeholder="john@example.com">
                <p class="form-hint">We'll send your evaluation report to this email.</p>
            </div>
            <div class="form-group">
                <label for="book_title">Book Title *</label>
                <input type="text" id="book_title" name="book_title" required placeholder="The Art of Writing">
            </div>
            <div class="form-group">
                <label for="proposal_type">Submission Type *</label>
                <select id="proposal_type" name="proposal_type" required>
                    <option value="full">Full Proposal (All Sections)</option>
                    <option value="marketing_only">Marketing Materials Only</option>
                    <option value="no_marketing">Proposal Without Marketing</option>
                </select>
            </div>
            <div class="form-group">
                <label>Upload Your Proposal *</label>
                <div class="upload-zone" id="drop-zone">
                    <input type="file" id="proposal_file" name="proposal_file" accept=".pdf,.doc,.docx" required style="display: none;">
                    <div id="upload-text">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p>Drag and drop your file here, or <span class="browse-link">browse</span></p>
                        <p class="form-hint">PDF, DOC, or DOCX (max 16MB)</p>
                    </div>
                    <div id="selected-file" class="selected-file hidden">
                        <svg width="24" height="24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                        <span id="selected-filename"></span>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="terms_accepted" name="terms_accepted" required>
                    <label for="terms_accepted" class="checkbox-label">
                        I agree to the <a href="#" onclick="document.getElementById('terms-modal').classList.remove('hidden'); return false;">Terms and Conditions</a> *
                    </label>
                </div>
            </div>
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="nda_accepted" name="nda_accepted" required>
                    <label for="nda_accepted" class="checkbox-label">
                        I agree to the <a href="#" onclick="document.getElementById('nda-modal').classList.remove('hidden'); return false;">Non-Disclosure Agreement</a> *
                    </label>
                </div>
            </div>
            <div class="submit-section">
                <button type="submit" class="btn btn-primary submit-btn">Submit for Evaluation</button>
            </div>
        </form>
    </div>
</div>

<section class="what-we-evaluate">
    <div class="container" style="text-align: center;">
        <h2>What We Evaluate</h2>
        <div class="eval-grid">
            <div class="eval-card"><h3>üìñ Concept & Hook</h3><p>Is your book idea compelling and marketable?</p></div>
            <div class="eval-card"><h3>üìä Market Analysis</h3><p>Do you understand your target audience?</p></div>
            <div class="eval-card"><h3>üë§ Author Platform</h3><p>What credentials and audience do you bring?</p></div>
            <div class="eval-card"><h3>‚úçÔ∏è Writing Sample</h3><p>Is your writing engaging and professional?</p></div>
            <div class="eval-card"><h3>üì£ Marketing Plan</h3><p>Do you have a concrete plan to reach readers?</p></div>
            <div class="eval-card"><h3>üìö Competitive Titles</h3><p>How does your book compare to existing titles?</p></div>
        </div>
    </div>
</section>

<div id="terms-modal" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <button class="modal-close" onclick="document.getElementById('terms-modal').classList.add('hidden')">&times;</button>
        <h2>Terms and Conditions</h2>
        <h3>Book Proposal Evaluation Terms and Conditions</h3>
        <p><strong>Effective Date:</strong> Upon submission</p>

        <h4>1. Service Description</h4>
        <p>Write It Great LLC ("Company") provides an AI-assisted book proposal evaluation service. By submitting your proposal, you acknowledge that the evaluation is generated using artificial intelligence technology and is intended as guidance only.</p>

        <h4>2. No Guarantee of Publishing Success</h4>
        <p>The evaluation results do not guarantee publication, representation, or commercial success. The scores and feedback provided are subjective assessments based on industry standards and should be considered as one of many factors in your publishing journey.</p>

        <h4>3. Intellectual Property</h4>
        <p>You retain all rights to your submitted materials. By submitting your proposal, you grant Write It Great LLC a limited license to process and analyze your content solely for the purpose of providing the evaluation service.</p>

        <h4>4. Data Handling</h4>
        <p>Your submitted materials will be processed securely. We do not share your content with third parties except as necessary to provide the evaluation service (e.g., AI processing). Proposal content may be temporarily stored for processing purposes.</p>

        <h4>5. Limitation of Liability</h4>
        <p>Write It Great LLC's liability is limited to the amount paid for the service, if any. We are not liable for any indirect, incidental, or consequential damages arising from use of the evaluation service.</p>

        <h4>6. Accuracy of Information</h4>
        <p>You represent that all information provided is accurate and that you have the right to submit the materials for evaluation.</p>

        <h4>7. Changes to Terms</h4>
        <p>We reserve the right to modify these terms at any time. Continued use of the service constitutes acceptance of modified terms.</p>

        <h4>8. Governing Law</h4>
        <p>These terms are governed by the laws of the State of New York, without regard to conflict of law principles.</p>

        <p style="margin-top: 1.5rem; font-style: italic; color: var(--gray-600);">By checking the agreement box, you acknowledge that you have read, understood, and agree to these Terms and Conditions.</p>
    </div>
</div>

<div id="nda-modal" class="modal-overlay hidden" onclick="if(event.target===this)this.classList.add('hidden')">
    <div class="modal-content" style="max-height: 80vh; overflow-y: auto;">
        <button class="modal-close" onclick="document.getElementById('nda-modal').classList.add('hidden')">&times;</button>
        <h2>Non-Disclosure Agreement</h2>
        <h3>PROJECT EVALUATION NDA</h3>
        <p><strong>NON-DISCLOSURE AGREEMENT</strong></p>

        <p>This non-disclosure agreement ("NDA") is between Write It Great LLC ("Company") and the submitting party ("Customer") as of the date of submission (the "Effective Date"). The NDA relates to the revelation of certain proprietary and/or confidential information by the Customer during the course of evaluating a potential working relationship. The terms and the obligations of both parties under this NDA shall come into effect immediately and shall be binding upon their respective heirs, successors, assigns, and affiliates.</p>

        <h4>1. CONFIDENTIAL INFORMATION</h4>
        <p>The Company acknowledges and agrees that all information, including without limitation, all content, writings, work product, notes, and diagrams ("Confidential Information"), is of great value to the Customer. Accordingly, the Company agrees not to divulge to anyone, either during or after the term of this NDA, any Confidential Information obtained by the Company. Upon the expiration or termination of this NDA, the Company agrees to make no further use of any Confidential Information. The Company may only disclose Confidential Information to third parties upon the express written consent of the Customer. The provisions of this Section shall survive the expiration or termination of this NDA.</p>

        <h4>2. ASSIGNMENT</h4>
        <p>The Customer and the Company may assign this NDA, in whole or in part, to any party provided that such party assumes and agrees in writing to keep and perform all obligations of the NDA hereunder.</p>

        <h4>3. BINDING EFFECT</h4>
        <p>This NDA shall inure to the benefit of and be binding on the Company's heirs, executors, administrators, successors, and assigns, and on the Customer's successors, assigns, licensees, and grantees.</p>

        <h4>4. TIME PERIODS</h4>
        <p>This NDA and the Company's duty to hold Confidential Information in confidence shall remain in effect until whichever of the following occurs first: (a) the Customer sends the Company written notice releasing it from this Provision, or (b) Confidential Information disclosed under this Provision ceases to be confidential.</p>

        <h4>5. BREACH</h4>
        <p>The Company appreciates the value of information and/or knowledge to be gained as a result of this NDA. In the event of disclosure prohibited by the terms of this NDA and/or breach of this NDA by the Company, the Company shall be liable to the Customer for any and all loss, whether tangible or intangible, including monetary loss of any kind and/or loss of goodwill. The Parties hereby acknowledge and agree that monetary damages would not be a sufficient remedy for any breach of this NDA. The Customer shall be entitled to seek injunctive or other equitable relief to remedy any breach or threatened breach by the Company and such remedy shall not be deemed the exclusive remedy for any breach of this NDA, but shall be in addition to all other rights and remedies available at law or equity.</p>

        <h4>6. RELATIONSHIPS</h4>
        <p>Nothing contained in this Provision shall be deemed to constitute either party a partner, joint venturer, or employee of the other party for any purpose.</p>

        <h4>7. SEVERABILITY</h4>
        <p>If a court finds any provision of this NDA invalid or unenforceable, the remainder of this NDA shall remain in effect to the intent of the parties.</p>

        <h4>8. WAIVER</h4>
        <p>The failure to exercise any right provided in this NDA shall not be a waiver of prior or subsequent rights.</p>

        <h4>9. SUCCESSOR AND ASSIGNS</h4>
        <p>This NDA and each party's obligations shall be binding on the representatives, assigns and successors of such party, if any.</p>

        <p style="margin-top: 1.5rem; font-style: italic; color: var(--gray-600);">By checking the NDA agreement box, you electronically sign and agree to the terms of this Non-Disclosure Agreement.</p>
    </div>
</div>

<div id="loading-overlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <p class="loading-text">Evaluating your proposal...</p>
    <p class="loading-subtext">This may take 30-60 seconds</p>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('proposal-form');
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('proposal_file');
    const uploadText = document.getElementById('upload-text');
    const selectedFile = document.getElementById('selected-file');
    const selectedFilename = document.getElementById('selected-filename');
    const loadingOverlay = document.getElementById('loading-overlay');

    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.classList.remove('dragover');
        if (e.dataTransfer.files.length) { fileInput.files = e.dataTransfer.files; updateFileDisplay(); }
    });
    fileInput.addEventListener('change', updateFileDisplay);

    function updateFileDisplay() {
        if (fileInput.files.length > 0) {
            uploadText.classList.add('hidden');
            selectedFile.classList.remove('hidden');
            selectedFilename.textContent = fileInput.files[0].name;
        }
    }

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const existingError = form.querySelector('.error-message');
        if (existingError) existingError.remove();
        loadingOverlay.classList.remove('hidden');
        
        try {
            const response = await fetch('/api/evaluate', { method: 'POST', body: new FormData(form) });
            const data = await response.json();
            if (data.success && data.proposal_id) {
                window.location.href = '/results/' + data.proposal_id;
            } else {
                loadingOverlay.classList.add('hidden');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.textContent = data.error || 'An error occurred.';
                form.querySelector('.submit-section').before(errorDiv);
            }
        } catch (error) {
            loadingOverlay.classList.add('hidden');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = 'Network error. Please try again.';
            form.querySelector('.submit-section').before(errorDiv);
        }
    });
});
</script>
{% endblock %}
